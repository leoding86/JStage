{"version":3,"file":"JStage.min.js","sources":["../src/JStage/Script.js","../src/JStage/Easing.js","../src/JStage/Obj.js","../src/JStage/Effect.js","../src/JStage/JStage.js"],"sourcesContent":["/**\n * 元素脚本\n * @param {string} property\n * @param {mixed} value 变化值，不是目标值\n * @param {mixed} duration\n * @param {string} timingFunction\n * @param {int} delay 毫秒单位\n */\nvar Script = function(property, value, duration, delay, timingFunction) {\n    this.transforms = ['scaleX', 'scaleY', 'skewX', 'skewY', 'rotate', 'translateX', 'translateY'];\n\n    this.id = Script.i++;\n    this.property = property;\n    this.value = value;\n    this.duration = this.normalizeTime(duration);\n    this.timingFunction = !!timingFunction ? timingFunction : 'linear';\n    this.delay = this.normalizeTime(delay);\n    this.status = Script.IDLE;\n};\n\nScript.i = 0;\nScript.IDLE = 0;\nScript.EXECUTING = 1;\nScript.SKIP = 2;\nScript.COMPLETE = 3;\n\nScript.prototype = {\n    reset: function() {\n        this.status = Script.IDLE;\n    },\n\n    executing: function() {\n        this.status = Script.EXECUTING;\n    },\n\n    skip: function() {\n        this.status = Script.SKIP;\n    },\n\n    complete: function() {\n        this.status = Script.COMPLETE;\n    },\n\n    isExecuting: function() {\n        return this.status === Script.EXECUTING;\n    },\n\n    isSkip: function() {\n        return this.status === Script.SKIP;\n    },\n\n    isComplete: function() {\n        return this.status === Script.COMPLETE;\n    },\n\n    normalizeTime: function(time) {\n        if (!time) {\n            return 0;\n        }\n    \n        if (typeof time === 'number') {\n            return time;\n        } else if (time.indexOf('ms') > 0) {\n            return time.slice(0, -2) - 0;\n        } else if (time.indexOf('s') > 0) {\n            return time.slice(0, -1) * 1000;\n        } else if (isNaN(time)) {\n            return time;\n        }\n    },\n\n    /**\n     * 根据运行进度来计算脚本当前进度的值\n     * @param {float} progress\n     */\n    getProgressValue: function(progress) {\n        return progress * this.value;\n    }\n};\n\nexport default Script;","/*\r\n * Easing Functions - inspired from http://gizma.com/easing/\r\n * only considering the t value for the range [0, 1] => [0, 1]\r\n */\r\n\r\nvar Easing = {\r\n    applyFunc: function(func, t) {\r\n        var easing;\r\n\r\n        if (func !== 'applyFunc' && undefined !== Easing[func]) {\r\n            easing = func;\r\n        } else {\r\n            easing = 'linear';\r\n        }\r\n\r\n        return Easing[easing](t);\r\n    },\r\n  // no easing, no acceleration\r\n  linear: function (t) { return t },\r\n  // accelerating from zero velocity\r\n  easeInQuad: function (t) { return t*t },\r\n  // decelerating to zero velocity\r\n  easeOutQuad: function (t) { return t*(2-t) },\r\n  // acceleration until halfway, then deceleration\r\n  easeInOutQuad: function (t) { return t<.5 ? 2*t*t : -1+(4-2*t)*t },\r\n  // accelerating from zero velocity\r\n  easeInCubic: function (t) { return t*t*t },\r\n  // decelerating to zero velocity\r\n  easeOutCubic: function (t) { return (--t)*t*t+1 },\r\n  // acceleration until halfway, then deceleration\r\n  easeInOutCubic: function (t) { return t<.5 ? 4*t*t*t : (t-1)*(2*t-2)*(2*t-2)+1 },\r\n  // accelerating from zero velocity\r\n  easeInQuart: function (t) { return t*t*t*t },\r\n  // decelerating to zero velocity\r\n  easeOutQuart: function (t) { return 1-(--t)*t*t*t },\r\n  // acceleration until halfway, then deceleration\r\n  easeInOutQuart: function (t) { return t<.5 ? 8*t*t*t*t : 1-8*(--t)*t*t*t },\r\n  // accelerating from zero velocity\r\n  easeInQuint: function (t) { return t*t*t*t*t },\r\n  // decelerating to zero velocity\r\n  easeOutQuint: function (t) { return 1+(--t)*t*t*t*t },\r\n  // acceleration until halfway, then deceleration\r\n  easeInOutQuint: function (t) { return t<.5 ? 16*t*t*t*t*t : 1+16*(--t)*t*t*t*t }\r\n}\r\n\r\nexport default Easing;","import Script from './Script';\nimport JStage from './JStage';\nimport Easing from './Easing';\n\nvar Obj = function(el, width, height, left, top) {\n    this.el, // dom对象\n    this.state = {},\n    this.intermediateState = {} // 中间状态\n    this.setups = {}, // 动画状态\n    this.loops = {},\n    this.propDiff = {},\n    this.executingScripts = {},\n    this.currentSetup,\n\n    this.width,\n    this.height,\n    this.left,\n    this.top,\n    this.duration = 0;\n    this.stage,\n    this.status = Obj.IS_STATIC,\n\n    this.setEl(el);\n    this.setSize(width, height);\n    this.setPosition(left, top);\n}\n\nObj.PROP_DEFAULT = {\n    scale   : 1,\n    scaleX  : 1,\n    scaleY  : 1,\n    translateX  : 0,\n    translateY  : 0,\n    rotate  : 0,\n    skew    : 0,\n    skewX   : 0,\n    skewY   : 0\n};\nObj.TRANSFORMS = [\n    'translateX',\n    'translateY',\n    'rotate',\n    'skew',\n    'skewX',\n    'skewY',\n    'scale',\n    'scaleX',\n    'scaleY',\n];\nObj.INIT_SETUP = 'INIT_SETUP'; // 初始化状态\nObj.OPEN_SETUP = 'OPEN_SETUP'; // 开场状态\nObj.IS_IDLE = 0;\nObj.IS_COMPLETED = 2;\nObj.IS_ANIMATING = 3;\nObj.IS_STATIC = 4;\n\nObj.addBatchSetups = function(objs, setups) {\n    objs.forEach(function(obj) {\n        for (var offset in setups) {\n            obj.addSetup(offset, setups[offset]);\n        }\n    });\n}\n\nObj.prototype = {\n    setState: function(prop, value) {\n        this.state[prop] = value;\n        return this;\n    },\n\n    /**\n     *\n     * @param {string} prop\n     */\n    getPropDefaultValue: function(prop) {\n        if (undefined === Obj.PROP_DEFAULT[prop]) {\n            return 0;\n        } else {\n            return Obj.PROP_DEFAULT[prop];\n        }\n    },\n\n    createSetup: function(offset) {\n        if (undefined === this.getSetup(offset)) {\n            this.setups[offset] = {\n                key: offset,\n                scripts: [],\n                setups: [],\n                index: 0,\n                startTimestamp: null\n            }\n        }\n    },\n\n    /**\n     * 添加状态脚本\n     * @param {string} offset\n     * @param {array} scripts\n     */\n    addSetup: function(offset, scripts) {\n        this.createSetup(offset);\n\n        var setup = this.getSetup(offset);\n\n        if (scripts instanceof Array && scripts.length > 0) {\n            scripts.forEach(function(script) {\n                this.addScript(offset, script)\n            }, this);\n        }\n\n        setup.duration = this.getDuration(setup);\n\n        return this;\n    },\n\n    /**\n     *\n     * @param {object} setups\n     */\n    addSetups: function(setups) {\n        for (var offset in setups) {\n            this.addSetup(offset, setups[offset]);\n        }\n    },\n\n    addLoopSetup: function(offset, setupOffsets) {\n        this.createSetup(offset);\n\n        setupOffsets.forEach(function(setupOffset) {\n            var setup = this.getSetup(setupOffset);\n\n            if (setup) {\n                this.getSetup(offset).setups.push(setup);\n            }\n        }, this);\n    },\n\n    addOpenSetup: function(scripts) {\n        this.addSetup(Obj.OPEN_SETUP, scripts);\n        return this;\n    },\n\n    /**\n     * 为状态添加一个脚本\n     * @param {string} offset\n     * @param {object} script\n     */\n    addScript: function(offset, script) {\n        this.createSetup(offset);\n\n        this.status = Obj.IS_IDLE;\n\n        this.setups[offset].scripts.push(\n            new Script(script.property, script.value, script.duration, script.delay, script.timingFunction)\n        );\n\n        return this;\n    },\n\n    /**\n     *\n     * @param {string} offset\n     */\n    getSetup: function(offset) {\n        return this.setups[offset];\n    },\n\n    getPropValue: function(state, prop) {\n        return (undefined === state[prop]) ? this.getPropDefaultValue(prop) : state[prop];\n    },\n\n    getPropDiffVal: function(prop, from, to) {\n        if (prop.toLowerCase().indexOf('color') > -1) {\n            throw 'unsupported property ' + prop;\n        }\n\n        return to - from;\n    },\n\n    createPropDiff: function(script) {\n        var prop = script.property;\n        var toValue;\n\n        if (typeof script.value === 'string' &&\n            (script.value.indexOf('+') === 0 ||\n            script.value.indexOf('-') === 0)\n        ) {\n            toValue = this.getPropValue(this.state, prop) + parseInt(script.value)\n        } else {\n            toValue = script.value;\n        }\n\n        this.propDiff[script.property] = {\n            prop: prop,\n            diffVal: this.getPropDiffVal(\n                script.property,\n                this.getPropValue(this.state, prop),\n                toValue\n            ),\n            fromVal: this.getPropValue(this.state, prop),\n            easing: script.timingFunction\n        };\n    },\n\n    patchPropDiff: function(propDiff, script) {\n        var prop = script.property;\n        var toValue;\n\n        if (typeof script.value === 'string' &&\n            (script.value.indexOf('+') === 0 ||\n            script.value.indexOf('-') === 0)\n        ) {\n            toValue = this.getPropValue(this.intermediateState, prop) + parseInt(script.value);\n        } else {\n            toValue = script.value;\n        }\n\n        propDiff.diffVal = this.getPropDiffVal(\n            script.property,\n            this.getPropValue(this.intermediateState, prop),\n            toValue\n        );\n        propDiff.fromVal = this.getPropValue(this.intermediateState, prop);\n    },\n\n    getPropDiff: function(offset) {\n        return this.propDiff[offset];\n    },\n\n    /**\n     *\n     * @param {object} propDIff\n     * @param {float} progress\n     */\n    updateIntermediateState: function(propDiff, progress) {\n        this.intermediateState[propDiff.prop] = (propDiff.diffVal * Easing.applyFunc(propDiff.easing, progress)) + propDiff.fromVal;\n    },\n\n    /**\n     *\n     * @param {string} setupOffset\n     * @returns {boolean} Return true if the object is updated otherwise return false\n     */\n    update: function(setupOffset) {\n        if (this.hasSetup(setupOffset) &&\n            !(this.isStatic() || this.isCompleted())\n        ) {\n            this.render(setupOffset === undefined ? Obj.OPEN_SETUP : setupOffset);\n            return true;\n        }\n\n        return false;\n    },\n\n    stop: function(setupOffset) {\n        this.complete();\n\n        var setup = this.getSetup(setupOffset);\n\n        if (setup.setups.length > 0) {\n            setup.index = 0;\n        }\n    },\n\n    render: function() {\n        var setup = this.currentSetup;\n\n        if (!setup) {\n            return;\n        }\n\n        if (setup.setups.length > 0) {\n            var loopSetup = setup.setups[setup.index];\n            // loop\n\n            if (!loopSetup.startTimestamp) {\n                loopSetup.startTimestamp = JStage.now();\n            }\n\n            var startTimestamp;\n            var currentTimestamp = this.getCurrentTimestamp();\n            var scripts = loopSetup.scripts;\n            var complete;\n\n            scripts.forEach(function(script) {\n                if (script.isComplete() || script.isSkip()) {\n                    return;\n                }\n\n                startTimestamp = loopSetup.startTimestamp;\n\n                complete = false;\n\n                if (script.delay > 0) {\n                    startTimestamp += script.delay;\n                }\n\n                if (startTimestamp > currentTimestamp) {\n                    return;\n                }\n\n                var progress = (currentTimestamp - startTimestamp) / script.duration;\n\n                if (progress > 1) {\n                    progress = 1;\n                }\n\n                script.executing();\n\n                if (undefined === this.executingScripts[script.property]) {\n                    this.executingScripts[script.property] = script;\n                    // create prop diff\n                    this.createPropDiff(script);\n                }\n\n                if (this.executingScripts[script.property] !== script &&\n                    !(script.isSkip() || script.isComplete())\n                ) {\n                    if (this.executingScripts[script.property].isExecuting()) {\n                        this.executingScripts[script.property].skip();\n                    }\n\n                    this.executingScripts[script.property] = script;\n                    // patch prop diff\n                    this.patchPropDiff(this.getPropDiff(script.property), script);\n                }\n\n                this.updateIntermediateState(this.getPropDiff(script.property), progress);\n\n                if (progress === 1) {\n                    script.complete();\n                }\n            }, this);\n\n            if (complete !== false) {\n                loopSetup.startTimestamp = null;\n\n                if (setup.index >= (setup.setups.length - 1)) {\n                    setup.index = 0;\n                } else {\n                    setup.index++;\n                }\n\n                this.standbyLoop(setup);\n            }\n        } else {\n            if (!setup.startTimestamp) {\n                setup.startTimestamp = this.getStartTimestamp();\n            }\n\n            var startTimestamp;\n            var currentTimestamp = this.getCurrentTimestamp();\n            var scripts = setup.scripts;\n            var complete;\n\n            scripts.forEach(function(script) {\n                if (script.isComplete() || script.isSkip()) {\n                    return;\n                }\n\n                startTimestamp = setup.startTimestamp;\n\n                complete = false;\n\n                if (script.delay > 0) {\n                    startTimestamp += script.delay;\n                }\n\n                if (startTimestamp > currentTimestamp) {\n                    return;\n                }\n\n                var progress = (currentTimestamp - startTimestamp) / script.duration;\n\n                if (progress > 1) {\n                    progress = 1;\n                }\n\n                script.executing();\n\n                if (undefined === this.executingScripts[script.property]) {\n                    this.executingScripts[script.property] = script;\n                    // create prop diff\n                    this.createPropDiff(script);\n                }\n\n                if (this.executingScripts[script.property] !== script &&\n                    !(script.isSkip() || script.isComplete())\n                ) {\n                    if (this.executingScripts[script.property].isExecuting()) {\n                        this.executingScripts[script.property].skip();\n                    }\n\n                    this.executingScripts[script.property] = script;\n                    // patch prop diff\n                    this.patchPropDiff(this.getPropDiff(script.property), script);\n                }\n\n                this.updateIntermediateState(this.getPropDiff(script.property), progress);\n\n                if (progress === 1) {\n                    script.complete();\n                }\n            }, this);\n\n            if (complete === false) {\n                this.status = Obj.IS_ANIMATING;\n            } else {\n                this.status = Obj.IS_COMPLETED;\n                setup.startTimestamp = null;\n            }\n        }\n\n        this.renderState();\n    },\n\n    renderState: function() {\n        var transformStyle = '';\n\n        for (var prop in this.intermediateState) {\n            if (Obj.TRANSFORMS.indexOf(prop) > -1) {\n                switch (prop) {\n                    case 'translateX':\n                    case 'translateY':\n                        transformStyle += prop + '(' + this.intermediateState[prop] + this.getScale() + 'px) ';\n                        break;\n                    case 'rotate':\n                    case 'skew':\n                    case 'skewX':\n                    case 'skewY':\n                        transformStyle += prop + '(' + this.intermediateState[prop] + 'deg) ';\n                        break;\n                    case 'scale':\n                    case 'scaleX':\n                    case 'scaleY':\n                        transformStyle += prop + '(' + this.intermediateState[prop] + ') ';\n                        break;\n                }\n            } else {\n                if (['left', 'top', 'width', 'height'].indexOf(prop) > -1) {\n                    this.el.style[prop] = this.intermediateState[prop] * this.getScale() + 'px';\n                } else {\n                    this.el.style[prop] = this.intermediateState[prop];\n                }\n            }\n        }\n\n        if (undefined !== transformStyle) {\n            JStage.setStyle(this.el, 'transform', transformStyle);\n        }\n    },\n\n    /**\n     * 设置物体尺寸\n     * @param {int} width\n     * @param {int} height\n     * @returns {this}\n     */\n    setSize: function(width, height) {\n        this.width = width;\n        this.height = height;\n\n        this.setState('width', width)\n            .setState('height', height);\n\n        return this;\n    },\n\n    /**\n     * 设置物体位置\n     * @param {int} left\n     * @param {int} top\n     * @returns {this}\n     */\n    setPosition: function(left, top) {\n        this.left = left;\n        this.top = top;\n\n        this.setState('left', left)\n            .setState('top', top);\n\n        return this;\n    },\n\n    /**\n     * 获得当前元素的缩放比例\n     * @returns {float}\n     */\n    getScale: function() {\n        return this.stage.scale;\n    },\n\n    /**\n     * 获得当前舞台的开始时间戳\n     * @returns {float}\n     */\n    getStartTimestamp: function() {\n        return this.stage.startTimestamp;\n    },\n\n    /**\n     * 获得当前舞台的当前时间戳\n     * @returns {float}\n     */\n    getCurrentTimestamp: function() {\n        return this.stage.currentTimestamp;\n    },\n\n    /**\n     * Get the object ready, placing and style it.\n     */\n    getReady: function() {\n        var openSetup = this.getSetup(Obj.OPEN_SETUP);\n\n        if (undefined !== openSetup) {\n            this.resetSetup(openSetup);\n            this.duration = this.getDuration(openSetup);\n        }\n\n        // 重置中间状态\n        this.intermediateState = {};\n\n        // 初始化元素样式状态，包括当前状态以及阶段状态\n        for (var prop in this.state) {\n            this.intermediateState[prop] = this.state[prop];\n        }\n\n        this.renderState();\n    },\n\n    /**\n     *\n     * @param {*} setupOffset\n     */\n    getSetupReady: function(setupOffset) {\n        // 重置中间状态\n        this.intermediateState = {};\n\n        var setup = this.getSetup(setupOffset);\n        var finState = this.getFinState(setup);\n\n        for (var prop in setup.scripts) {\n            if (undefined === finState[prop]) {\n                finState[prop] = setup.scripts[prop];\n            }\n        }\n\n        for (var prop in finState) {\n            this.intermediateState[prop] = finState[prop];\n        }\n\n        this.duration = this.getDuration(setup);\n        this.renderState();\n    },\n\n    /**\n     * Set object dom\n     * @param {mixed} el\n     */\n    setEl: function(el) {\n        this.el = JStage.getEl(el);\n    },\n\n    /**\n     * Check if the object is animating\n     * @returns {boolean}\n     */\n    isAnimating: function() {\n        return this.status === Obj.IS_ANIMATING;\n    },\n\n    /**\n     * Check if the object's animation is complete\n     * @returns {boolean}\n     */\n    isCompleted: function() {\n        return this.status === Obj.IS_COMPLETED;\n    },\n\n    /**\n     * Set object animation is completed.\n     */\n    complete: function() {\n        this.status = Obj.IS_COMPLETED;\n    },\n\n    /**\n     * 判断元素是否是静止元素\n     * @returns {boolean}\n     */\n    isStatic: function() {\n        return this.status === Obj.IS_STATIC;\n    },\n\n    /**\n     * 判断元素是否是等待动画执行状态\n     * @returns {boolean}\n     */\n    isIdle: function() {\n        return this.status === Obj.IS_IDLE;\n    },\n\n    /**\n     * 重计算部分脚本\n     * 主要用于更新场景大小变化后元素的各种尺寸和位置相关属性\n     */\n    recal: function() {\n        if (!this.isAnimating()) {\n            this.renderState();\n        }\n    },\n\n    /**\n     * 将物体添加到指定的舞台上\n     * @param {JStage.Stage} stage\n     */\n    appendToStage: function(stage) {\n        stage.appendObj(this);\n    },\n\n    /**\n     * 设置物体到指定的舞台上\n     * @param {JStage.setStage} stage\n     */\n    setStage: function(stage) {\n        this.stage = stage;\n    },\n\n    /**\n     * 重置舞台元素状态\n     */\n    reset: function() {\n        this.getReady();\n    },\n\n    /**\n     * 设置舞台播放到指定毫秒数\n     * @param {int} time 舞台播放到指定毫秒数\n     */\n    setTime: function(time) {\n        //\n    },\n\n    /**\n     * 获得动画时间，这个时间包含延迟时间\n     * @param {object} setup\n     * @returns {int}\n     */\n    getDuration: function(setup) {\n        var duration = 0;\n        var scriptDuration = 0;\n\n        setup.scripts.forEach(function(script) {\n            scriptDuration = script.duration + script.delay;\n\n            if (duration < scriptDuration) {\n                duration = scriptDuration;\n            }\n        });\n\n        return duration;\n    },\n\n    /**\n     * 获得设置的最终状态，需要处理同属性延迟执行的情况，比如两个left移动先后执行\n     * @param {object} setup\n     */\n    getFinState: function(setup) {\n        var finState = {};\n        var propDelay = {};\n\n        setup.scripts.forEach(function(script) {\n            if (undefined === propDelay[script.property]) {\n                propDelay[script.property] = script.delay;\n                finState[script.property] = script.property;\n            } else if (script.delay > propDelay[script.property]) {\n                propDelay[script.property] = script.delay;\n                finState[script.property] = script.property;\n            }\n        });\n\n        return finState;\n    },\n\n    /**\n     * Reset setup status, include scripts in the setup\n     * @param {object} setup\n     */\n    resetSetup: function(setup) {\n        setup.scripts.forEach(function(script) {\n            /**\n             * Reset script status\n             */\n            script.reset();\n        });\n    },\n\n    /**\n     * Get the setup ready\n     * @param {Object|string} offset\n     */\n    standby: function(offset) {\n        var setup = typeof offset === 'object' ? offset : this.getSetup(offset);\n\n        if (undefined === setup) {\n            return;\n        }\n\n        /**\n         * If the setup is a loop setup, should get the setups in this ready\n         */\n        if (setup.setups.length > 0) {\n            setup.setups.forEach(function(loopSetup) {\n                this.standby(loopSetup);\n            }, this);\n        }\n\n        this.currentSetup = setup;\n        setup.startTimestamp = null;\n        this.status = Obj.IS_IDLE;\n        this.resetSetup(setup);\n    },\n\n    /**\n     * Get the setup in side the loop ready\n     * @param {Object} setup Loop setup\n     */\n    standbyLoop: function(setup) {\n        this.standby(setup.setups[setup.index]);\n\n        // Override current setup to current loop setup\n        this.currentSetup = setup;\n    },\n\n    /**\n     * Check if object has specified setup\n     * @param {string} offset\n     */\n    hasSetup: function(offset) {\n        return undefined !== this.setups[offset];\n    }\n};\n\nexport default Obj;","import JStage from './JStage';\n\nvar Effect = {\n    start: function() {\n        if (!JStage.inProgress) {\n            if (window.requestAnimationFrame) {\n                window.requestAnimationFrame(Effect.update);\n            } else {\n                setTimeout(Effect.update, JStage.interval);\n            }\n        }\n    },\n\n    update: function(timestamp) {\n        var timestamp = timestamp ? timestamp : JStage.now();\n\n        JStage.inProgress = true;\n\n        JStage.stages.forEach(function(stage) {\n            stage.update(timestamp);\n        });\n\n        if (window.requestAnimationFrame) {\n            window.requestAnimationFrame(Effect.update)\n        } else {\n            setTimeout(Effect.update, JStage.interval);\n        }\n    }\n}\n\nexport default Effect;\n","import Obj from './Obj';\nimport Effect from './Effect';\n\n/**\n * 舞台构造函数\n * @constructor\n * @param {int} el\n * @param {int} width 舞台的标准宽度，不是元素的实际宽度\n * @param {int} height 舞台的标准高度，不是元素的实际高度\n */\nfunction JStage(el, width, height) {\n    if (!JStage.createFromStatic) {\n        throw 'You should use JStage.createStage() method to create stage'\n    }\n\n    /**\n     * Reset for next calling\n     */\n    JStage.createFromStatic = false;\n\n    this.el = JStage.getEl(el);\n    this.width = width,\n    this.height = height,\n    this.scale,\n    this.startTimestamp,\n    this.currentTimestamp,\n    this.duration = 0,\n    this.status = JStage.STATUS_IDLE,\n    this.currentSetupOffsets = [],\n    this.loops = [],\n    this.resources = [],\n    this.objs = [];\n}\n\nJStage.createFromStatic = false;\nJStage.interval = 13;\nJStage.inProgress = false;\nJStage.stages = [];\nJStage.STATUS_IDLE = 0;\nJStage.STATUS_IN_PROGRESS = 1;\nJStage.STATUS_COMPLETE = 2;\n\nJStage.now = function() {\n    if (performance && performance.now) {\n        return performance.now();\n    } else {\n        return Date.now();\n    }\n};\n\nJStage.setStyle = function(node, property, value) {\n    var prefixs = ['ms', 'webkit', 'moz'];\n\n    if (node.style[property] !== undefined) {\n        node.style[property] = value;\n    } else {\n        var propertyName;\n        property = property.charAt(0).toUpperCase() + property.slice(1);\n\n        for (var i = 0, l = prefixs.length; i < l; i++) {\n            propertyName = prefixs[i] + property;\n\n            if (node.style[propertyName] !== undefined) {\n                node.style[propertyName] = value;\n                break;\n            }\n        }\n    }\n};\n\nJStage.getEl = function(el) {\n    if (typeof el === 'string') {\n        if (document.querySelector) {\n            return document.querySelector(el);\n        } else if (el.indexOf('#') === 0) {\n            return document.getElementById(el.slice(1));\n        } else {\n            throw 'el should be a string if it\\'s not a Node';\n        }\n    } else if (jQuery && el instanceof jQuery) {\n        return el[0];\n    } else if (typeof el === 'object' &&\n        (el instanceof Node && el.nodeType > 0)\n    ) {\n        return el;\n    } else {\n        throw 'Invalid el';\n    }\n};\n\nJStage.normalizeTime = function(time) {\n    if (!time) {\n        return 0;\n    }\n\n    if (typeof time === 'number') {\n        return time;\n    } else if (time.indexOf('ms') > 0) {\n        return time.slice(0, -2) - 0;\n    } else if (time.indexOf('s') > 0) {\n        return time.slice(0, -1) * 1000;\n    } else if (isNaN(time)) {\n        return time;\n    }\n};\n\nJStage.getStyle = function(el, prop) {\n    if (typeof getComputedStyle === undefined) {\n        return el.currentStyle[prop];\n    } else {\n        return getComputedStyle(el, null).getPropertyValue(prop);\n    }\n};\n\n/**\n * Static method for creating a stage and you should use this to create stage,\n * because JStage will maintain a array of stages.\n * @param {mixed} el\n * @param {int} width\n * @param {int} height\n */\nJStage.create = function(el, width, height) {\n    JStage.createFromStatic = true;\n\n    var stage = new JStage(el, width, height);\n    JStage.stages.push(stage);\n\n    return stage;\n};\n\nJStage.prototype = {\n    /**\n     * 添加资源\n     * @param {string} resource\n     */\n    addResource: function(resource) {\n        if (this.resources.indexOf(resource) < 0) {\n            this.resources.push(resource);\n        }\n\n        return this;\n    },\n\n    loadResources: function(callbacks) {\n        var len = this.resources.length;\n        var loadedLen = 0;\n\n        this.resources.forEach(function(resource) {\n            var image = new Image;\n            image.onload = function() {\n                loadedLen++;\n\n                if (callbacks.onProgress && typeof callbacks.onProgress === 'function') {\n                    callbacks.onProgress.call(this, len, loadedLen);\n                }\n\n                if (loadedLen === len && callbacks.onComplete && typeof callbacks.onComplete === 'function') {\n                    callbacks.onComplete.call(null);\n                }\n            }\n\n            image.src = resource;\n\n            if (image.complete) {\n                image.load();\n            }\n        });\n    },\n\n    /**\n     * 在舞台上创建一个物体\n     * @param {mixed} el 元素对象\n     * @param {int} width\n     * @param {int} height\n     * @param {int} left\n     * @param {int} right\n     * @returns {Obj}\n     */\n    createObj: function(el, width, height, left, right) {\n        var obj = new Obj(el, width, height, left, right);\n        this.appendObj(obj);\n        return obj;\n    },\n\n    inProgress: function() {\n        return this.status === JStage.STATUS_IN_PROGRESS;\n    },\n\n    isComplete: function() {\n        return this.status === JStage.STATUS_COMPLETE;\n    },\n\n    isIdle: function() {\n        return this.status === JStage.STATUS_IDLE;\n    },\n\n    inSetup: function(setupOffset) {\n        return this.currentSetupOffsets.indexOf(setupOffset) > -1;\n    },\n\n    addCurrentSetupOffset: function(setupOffset) {\n        if (this.currentSetupOffsets.indexOf(setupOffset) < 0) {\n            this.currentSetupOffsets.push(setupOffset);\n        }\n    },\n\n    removeFromCurrentSetups: function(setupOffset) {\n        var index = this.currentSetupOffsets.indexOf(setupOffset);\n\n        if (index > -1) {\n            this.currentSetupOffsets.splice(index, 1);\n        }\n    },\n\n    /**\n     * 初始化舞台\n     */\n    init: function() {\n        var self = this;\n\n        this.setScale(this.el.offsetWidth, this.el.offsetHeight);\n\n        this.el.style.width = this.width * this.scale + 'px';\n        this.el.style.height = this.height * this.scale + 'px';\n\n        // 将舞台元素准备到位\n        this.objs.forEach(function(obj) {\n            obj.getReady();\n\n            if (obj.duration > self.duration) {\n                self.duration = obj.duration;\n            }\n        });\n    },\n\n    /**\n     * Prepare for starting setup\n     * @param {string} setupOffset\n     */\n    standby: function(setupOffset) {\n        this.startTimestamp = null;\n        this.currentTimestamp = null;\n        this.status = JStage.STATUS_IDLE;\n\n        if (undefined === setupOffset) {\n            return;\n        }\n\n        this.objs.forEach(function(obj) {\n            obj.standby(setupOffset);\n        }, this);\n    },\n\n    /**\n     * 重置舞台元素实际尺寸\n     * @param {int|float} width\n     * @param {int|float} height\n     */\n    resizeEl: function(width, height) {\n        this.setScale(width, height)\n\n        // 设置舞台元素的尺寸\n        this.el.style.width = this.width * this.scale + 'px';\n        this.el.style.height = this.height * this.scale + 'px';\n\n        this.objs.forEach(function(obj) {\n            obj.recal();\n        });\n    },\n\n    /**\n     * 设置舞台的缩放比例\n     * @param {int|float} width 舞台元素实际宽度\n     * @param {int|float} height 舞台元素实际宽度\n     */\n    setScale: function(width, height) {\n        var wScale = width / this.width;\n        var hScale = height / this.height;\n\n        if (wScale > hScale) {\n            this.scale = hScale;\n        } else {\n            this.scale = wScale;\n        }\n\n        return this;\n    },\n\n    start: function() {\n        this.startSetup(Obj.OPEN_SETUP);\n    },\n\n    startSetup: function(setupOffset) {\n        if (this.inSetup(setupOffset)) {\n            return;\n        }\n\n        this.addCurrentSetupOffset(setupOffset);\n        this.standby(setupOffset);\n\n        this.startTimestamp = JStage.now();\n\n        Effect.start();\n\n        // if (!this.isAnimating()) {\n        //     this.status = JStage.IS_ANIMATING;\n\n        //     if (window.requestAnimationFrame) {\n        //         window.requestAnimationFrame(this.update.bind(this));\n        //     } else {\n        //         setTimeout(this.update.bind(this), JStage.interval);\n        //     }\n        // }\n    },\n\n    stopSetup: function(offset) {\n        this.objs.forEach(function(obj) {\n            if (obj.hasSetup(offset)) {\n                obj.stop(offset);\n            }\n        });\n    },\n\n    /**\n     * Called from Effect.update method for updating stage\n     * @param {float} timestamp\n     */\n    update: function(timestamp) {\n        if (this.isComplete()) {\n            return false;\n        }\n\n        this.updateSetup(timestamp);\n        return true;\n    },\n\n    updateSetup: function(timestamp) {\n        this.currentTimestamp = timestamp;\n\n        if (this.currentSetupOffsets.length > 0) {\n            this.status = JStage.STATUS_IN_PROGRESS;\n\n            this.currentSetupOffsets.forEach(function(setupOffset) {\n                var finished;\n\n                this.objs.forEach(function(obj) {\n                    if (obj.update(setupOffset)) {\n                        finished = false;\n                    }\n                }, this);\n\n                if (finished === undefined) {\n                    this.removeFromCurrentSetups(setupOffset);\n                }\n            }, this);\n        } else {\n            this.status = JStage.STATUS_COMPLETE;\n        }\n    },\n\n    setTime: function(time) {\n        //\n    },\n\n    setProgress: function(progress) {\n        //\n    },\n\n    /**\n     * 往舞台上添加物体\n     * @param {JShow.Obj} obj\n     */\n    appendObj: function(obj) {\n        if (!obj.stage && obj.stage !== this) {\n            this.objs.push(obj);\n            obj.setStage(this);\n        }\n    }\n};\n\nexport default JStage;"],"names":["Script","property","value","duration","delay","timingFunction","this","transforms","id","i","normalizeTime","status","IDLE","EXECUTING","SKIP","COMPLETE","prototype","reset","executing","skip","complete","isExecuting","isSkip","isComplete","time","indexOf","slice","isNaN","getProgressValue","progress","Easing","applyFunc","func","t","easing","undefined","linear","easeInQuad","easeOutQuad","easeInOutQuad","easeInCubic","easeOutCubic","easeInOutCubic","easeInQuart","easeOutQuart","easeInOutQuart","easeInQuint","easeOutQuint","easeInOutQuint","Obj","el","width","height","left","top","state","intermediateState","setups","loops","propDiff","executingScripts","currentSetup","stage","IS_STATIC","setEl","setSize","setPosition","PROP_DEFAULT","scale","scaleX","scaleY","translateX","translateY","rotate","skew","skewX","skewY","TRANSFORMS","INIT_SETUP","OPEN_SETUP","IS_IDLE","IS_COMPLETED","IS_ANIMATING","addBatchSetups","objs","forEach","obj","offset","addSetup","setState","prop","getPropDefaultValue","createSetup","getSetup","key","scripts","index","startTimestamp","setup","Array","length","script","addScript","getDuration","addSetups","addLoopSetup","setupOffsets","setupOffset","push","addOpenSetup","getPropValue","getPropDiffVal","from","to","toLowerCase","createPropDiff","toValue","parseInt","diffVal","fromVal","patchPropDiff","getPropDiff","updateIntermediateState","update","hasSetup","isStatic","isCompleted","render","stop","loopSetup","JStage","now","currentTimestamp","getCurrentTimestamp","standbyLoop","getStartTimestamp","renderState","transformStyle","getScale","style","setStyle","getReady","openSetup","resetSetup","getSetupReady","finState","getFinState","getEl","isAnimating","isIdle","recal","appendToStage","appendObj","setStage","setTime","scriptDuration","propDelay","standby","Effect","start","inProgress","window","requestAnimationFrame","setTimeout","interval","timestamp","stages","createFromStatic","STATUS_IDLE","currentSetupOffsets","resources","STATUS_IN_PROGRESS","STATUS_COMPLETE","performance","Date","node","prefixs","propertyName","charAt","toUpperCase","l","document","querySelector","getElementById","jQuery","Node","nodeType","getStyle","getComputedStyle","currentStyle","getPropertyValue","create","addResource","resource","loadResources","callbacks","len","loadedLen","image","Image","onload","onProgress","call","onComplete","src","load","createObj","right","inSetup","addCurrentSetupOffset","removeFromCurrentSetups","splice","init","self","setScale","offsetWidth","offsetHeight","resizeEl","wScale","hScale","startSetup","stopSetup","updateSetup","finished","setProgress"],"mappings":"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"}