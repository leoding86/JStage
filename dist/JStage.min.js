function JStage(t,e,i){this.el=JStage.getEl(t),this.width=e,this.height=i,this.scale,this.startTimestamp,this.currentTimestamp,this.duration=0,this.status=JStage.IS_IDLE,this.currentSetupOffset,this.resources=[],this.objs=[]}JStage.getEl=function(t){if("string"==typeof t)return document.querySelector(t);if(t instanceof jQuery)return t[0];if("object"==typeof t&&t instanceof Node&&0<t.nodeType)return t;throw"Invalid el"},JStage.normalizeTime=function(t){if(!t)return 0;if(0<t.indexOf("ms"))return t.slice(0,-2)-0;if(0<t.indexOf("s"))return 1e3*t.slice(0,-1);if(isNaN(t))throw"Invalid time"},JStage.getStyle=function(t,e){return void 0===typeof getComputedStyle?t.currentStyle[e]:getComputedStyle(t,null).getPropertyValue(e)},JStage.IS_IDLE=0,JStage.IS_FINISHED=1,JStage.prototype={addResource:function(t){return this.resources.indexOf(t)<0&&this.resources.push(t),this},loadResources:function(i){var s=this.resources.length,r=0;this.resources.forEach(function(t){var e=new Image;e.onload=function(){console.log("image load"),r++,i.onProgress&&"function"==typeof i.onProgress&&i.onProgress.call(this,s,r),r===s&&i.onComplete&&"function"==typeof i.onComplete&&i.onComplete.call(null)},e.src=t,e.complete&&e.load()})},createObj:function(t,e,i,s,r){var a=new JStage.Obj(t,e,i,s,r);return this.appendObj(a),a},init:function(){var e=this;this.setScale(this.el.offsetWidth,this.el.offsetHeight),this.el.style.width=this.width*this.scale+"px",this.el.style.height=this.height*this.scale+"px",this.objs.forEach(function(t){t.getReady(),t.duration>e.duration&&(e.duration=t.duration)})},standby:function(e){this.startTimestamp=null,this.currentTimestamp=null,this.objs.forEach(function(t){t.standby(e)},this)},resizeEl:function(t,e){this.setScale(t,e),this.el.style.width=this.width*this.scale+"px",this.el.style.height=this.height*this.scale+"px",this.objs.forEach(function(t){t.recal()})},setScale:function(t,e){var i=t/this.width,s=e/this.height;return this.scale=s<i?s:i,this},start:function(){this.startSetup(JStage.Obj.OPEN_SETUP)},startSetup:function(t){this.currentSetupOffset=t,this.standby(t),window.requestAnimationFrame?window.requestAnimationFrame(this.update.bind(this)):this.objs.forEach(function(t){t.isStatic()||t.setProgress(1)})},update:function(t){var e;this.startTimestamp||(this.startTimestamp=t),this.currentTimestamp=t;for(var i=0,s=this.objs.length;i<s;i++){var r=this.objs[i];!r.hasSetup(this.currentSetupOffset)||r.isStatic()||r.isCompleted()||(e=!1,r.update(this.currentSetupOffset))}!1===e&&window.requestAnimationFrame(this.update.bind(this))},setTime:function(t){for(var e=0,i=this.objs.length;e<i;e++)this.objs[e].isStatic()||this.objs[e].setTime(t)},setProgress:function(t){var e=this.duration*t;this.setTime(e)},appendObj:function(t){t.stage||t.stage===this||(this.objs.push(t),t.setStage(this))}},JStage.Obj=function(t,e,i,s,r){this.el,this.state={},this.intermediateState={},this.setups={},this.propDiff={},this.executingScripts={},this.transformState={},this.styleState={},this.width,this.height,this.left,this.top,this.duration=0,this.stage,this.status=JStage.Obj.IS_STATIC,this.setEl(t),this.setSize(e,i),this.setPosition(s,r)},JStage.Obj.PROP_DEFAULT={scale:1,scaleX:1,scaleY:1,translateX:0,translateY:0,rotate:0,skew:0,skewX:0,skewY:0},JStage.Obj.TRANSFORMS=["translateX","translateY","rotate","skew","skewX","skewY","scale","scaleX","scaleY"],JStage.Obj.INIT_SETUP="INIT_SETUP",JStage.Obj.OPEN_SETUP="OPEN_SETUP",JStage.Obj.IS_IDLE=0,JStage.Obj.IS_COMPLETED=2,JStage.Obj.IS_ANIMATING=3,JStage.Obj.IS_STATIC=4,JStage.Obj.prototype={setState:function(t,e){return this.state[t]=e,this},getPropDefaultValue:function(t){return void 0===JStage.Obj.PROP_DEFAULT[t]?0:JStage.Obj.PROP_DEFAULT[t]},createSetup:function(t){void 0===this.getSetup(t)&&(this.setups[t]={scripts:[]})},addSetup:function(e,t){return this.createSetup(e),t instanceof Array&&0<t.length&&t.forEach(function(t){this.addScript(e,t)},this),this},addOpenSetup:function(t){return this.addSetup(JStage.Obj.OPEN_SETUP,t),this},addScript:function(t,e){return this.createSetup(t),this.status=JStage.Obj.IS_IDLE,this.setups[t].scripts.push(new JStage.Script(e.property,e.value,e.duration,e.delay,e.timingFunction)),this},getSetup:function(t){return this.setups[t]},getPropDiffVal:function(t,e,i){if(-1<t.toLowerCase().indexOf("color"))throw"unsupported property "+t;return i-e},createPropDiff:function(t){var e=t.property;this.propDiff[t.property]={prop:t.property,diffVal:this.getPropDiffVal(t.property,void 0===this.state[e]?this.getPropDefaultValue(e):this.state[e],t.value),fromVal:this.state[e]}},patchPropDiff:function(t,e){var i=e.property;t.diffVal=this.getPropDiffVal(e.property,this.intermediateState[i],e.value),t.fromVal=this.intermediateState[i]},getPropDiff:function(t){return this.propDiff[t]},updateIntermediateState:function(t,e){this.intermediateState[t.prop]=e*t.diffVal+t.fromVal},update:function(t){this.render(void 0===t?JStage.Obj.OPEN_SETUP:t)},render:function(t){if(void 0!==this.getSetup(t)){var i,s=this.getStartTimestamp(),r=this.getCurrentTimestamp();this.getSetup(t).scripts.forEach(function(t){if(0<t.delay&&(s+=t.delay),!(r<s)){var e=(r-s)/t.duration;1<e&&(e=1),t.isComplete()||t.isSkip()||(i=!1,t.executing(),void 0===this.executingScripts[t.property]&&(this.executingScripts[t.property]=t,this.createPropDiff(t)),this.executingScripts[t.property]===t||t.isSkip()||t.isComplete()||(this.executingScripts[t.property].isExecuting()&&this.executingScripts[t.property].skip(),this.executingScripts[t.property]=t,this.patchPropDiff(this.getPropDiff(t.property),t)),this.updateIntermediateState(this.getPropDiff(t.property),e),1===e&&t.complete())}},this),this.status=!1===i?JStage.Obj.IS_ANIMATING:JStage.Obj.IS_COMPLETED,this.renderState()}},renderState:function(){for(var t in console.log(this.intermediateState),this.intermediateState)if(-1<JStage.Obj.TRANSFORMS.indexOf(t)){var e="";switch(t){case"translateX":case"translateY":e+=t+"("+this.intermediateState[t]+this.getScale()+"px) ";break;case"rotate":case"skew":case"skewX":case"skewY":e+=t+"("+this.intermediateState[t]+"deg) ";break;case"scale":case"scaleX":case"scaleY":e+=t+"("+this.intermediateState[t]+") "}}else-1<["left","top","width","height"].indexOf(t)?this.el.style[t]=this.intermediateState[t]*this.getScale()+"px":this.el.style[t]=this.intermediateState[t];void 0!==e&&(this.el.style.transform=e)},setSize:function(t,e){return this.width=t,this.height=e,this.setState("width",t).setState("height",e),this},setPosition:function(t,e){return this.left=t,this.top=e,this.setState("left",t).setState("top",e),this},getScale:function(){return this.stage.scale},getStartTimestamp:function(){return this.stage.startTimestamp},getCurrentTimestamp:function(){return this.stage.currentTimestamp},getReady:function(){var t=this.getSetup(JStage.Obj.OPEN_SETUP);for(var e in void 0!==t&&this.resetSetup(t),this.intermediateState={},this.state)this.intermediateState[e]=this.state[e];this.duration=this.getDuration(t),this.renderState()},getStateReady:function(t){this.intermediateState={};var e=this.getSetup(t),i=this.getFinState(state);for(var s in e.scripts)void 0===i[s]&&(i[s]=e.scripts[s]);for(var s in i)this.intermediateState[s]=i[s];this.duration=this.getDuration(e),this.renderState()},setEl:function(t){this.el=JStage.getEl(t)},isAnimating:function(){return this.status===JStage.Obj.IS_ANIMATING},isCompleted:function(){return this.status===JStage.Obj.IS_COMPLETED},isStatic:function(){return this.status===JStage.Obj.IS_STATIC},isIdle:function(){return this.status===JStage.Obj.IS_IDLE},recal:function(){this.isAnimating()||this.renderState()},appendToStage:function(t){t.appendObj(this)},setStage:function(t){this.stage=t},reset:function(){this.getReady()},setTime:function(t){},getDuration:function(t){var e=0;return t.scripts.forEach(function(t){0<(e=t.duration+t.delay)&&(durtaion=e)}),0},getFinState:function(t){var e={},i={};return t.scripts.forEach(function(t){void 0===i[t.property]?(i[t.property]=t.delay,e[t.property]=t.property):t.delay>i[t.property]&&(i[t.property]=t.delay,e[t.property]=t.property)}),e},resetSetup:function(t){t.scripts.forEach(function(t){t.reset()})},standby:function(t){var e=this.getSetup(t);void 0!==e&&(console.log(this),this.status=JStage.Obj.IS_IDLE,this.resetSetup(e))},hasSetup:function(t){return void 0!==this.setups[t]}},JStage.Script=function(t,e,i,s,r){this.transforms=["scaleX","scaleY","skewX","skewY","rotate","translateX","translateY"],this.id=JStage.Script.i++,this.property=t,this.value=e,this.duration=this.normalizeTime(i),this.timingFunction=r||"linear",this.delay=this.normalizeTime(s),this.status=JStage.Script.IDLE},JStage.Script.i=0,JStage.Script.IDLE=0,JStage.Script.EXECUTING=1,JStage.Script.SKIP=2,JStage.Script.COMPLETE=3,JStage.Script.prototype={reset:function(){this.status=JStage.Script.IDLE},executing:function(){this.status=JStage.Script.EXECUTING},skip:function(){this.status=JStage.Script.SKIP},complete:function(){this.status=JStage.Script.COMPLETE},isExecuting:function(){return this.status===JStage.Script.EXECUTING},isSkip:function(){return this.status===JStage.Script.SKIP},isComplete:function(){return this.status===JStage.Script.COMPLETE},normalizeTime:function(t){if(!t)return 0;if(0<t.indexOf("ms"))return t.slice(0,-2)-0;if(0<t.indexOf("s"))return 1e3*t.slice(0,-1);if(isNaN(t))throw"Invalid time"},getProgressValue:function(t){return t*this.value}},function(t,e){"function"==typeof define&&define.amd?define(e):"object"==typeof module&&module.exports?module.exports=e():t.JStage=e()}(window,function(){return JStage});
//# sourceMappingURL=maps/JStage.min.js.map
