function JStage(t,e,i){this.el=JStage.getEl(t),this.width=e,this.height=i,this.scale,this.startTimestamp,this.currentTimestamp,this.duration=0,this.status=JStage.IS_IDLE,this.currentSetupOffsets=[],this.loops=[],this.resources=[],this.objs=[]}JStage.getEl=function(t){if("string"==typeof t)return document.querySelector(t);if(t instanceof jQuery)return t[0];if("object"==typeof t&&t instanceof Node&&0<t.nodeType)return t;throw"Invalid el"},JStage.normalizeTime=function(t){return t?"number"==typeof t?t:0<t.indexOf("ms")?t.slice(0,-2)-0:0<t.indexOf("s")?1e3*t.slice(0,-1):isNaN(t)?t:void 0:0},JStage.getStyle=function(t,e){return void 0===typeof getComputedStyle?t.currentStyle[e]:getComputedStyle(t,null).getPropertyValue(e)},JStage.IS_IDLE=0,JStage.IS_FINISHED=1,JStage.IS_ANIMATING=2,JStage.prototype={addResource:function(t){return this.resources.indexOf(t)<0&&this.resources.push(t),this},loadResources:function(i){var s=this.resources.length,r=0;this.resources.forEach(function(t){var e=new Image;e.onload=function(){r++,i.onProgress&&"function"==typeof i.onProgress&&i.onProgress.call(this,s,r),r===s&&i.onComplete&&"function"==typeof i.onComplete&&i.onComplete.call(null)},e.src=t,e.complete&&e.load()})},createObj:function(t,e,i,s,r){var n=new JStage.Obj(t,e,i,s,r);return this.appendObj(n),n},isAnimating:function(){return this.status===JStage.IS_ANIMATING},inSetup:function(t){return-1<this.currentSetupOffsets.indexOf(t)},addCurrentSetupOffset:function(t){this.currentSetupOffsets.indexOf(t)<0&&this.currentSetupOffsets.push(t)},removeFromCurrentSetups:function(t){var e=this.currentSetupOffsets.indexOf(t);-1<e&&this.currentSetupOffsets.splice(e,1)},init:function(){var e=this;this.setScale(this.el.offsetWidth,this.el.offsetHeight),this.el.style.width=this.width*this.scale+"px",this.el.style.height=this.height*this.scale+"px",this.objs.forEach(function(t){t.getReady(),t.duration>e.duration&&(e.duration=t.duration)})},standby:function(e){this.startTimestamp=null,this.currentTimestamp=null,void 0!==e&&this.objs.forEach(function(t){t.standby(e)},this)},resizeEl:function(t,e){this.setScale(t,e),this.el.style.width=this.width*this.scale+"px",this.el.style.height=this.height*this.scale+"px",this.objs.forEach(function(t){t.recal()})},setScale:function(t,e){var i=t/this.width,s=e/this.height;return this.scale=s<i?s:i,this},start:function(){this.startSetup(JStage.Obj.OPEN_SETUP)},startSetup:function(t){this.addCurrentSetupOffset(t),this.standby(t),window.requestAnimationFrame?this.isAnimating()||(this.status=JStage.IS_ANIMATING,window.requestAnimationFrame(this.update.bind(this))):this.objs.forEach(function(t){t.isStatic()||t.setProgress(1)})},stopSetup:function(e){this.objs.forEach(function(t){t.hasSetup(e)&&t.stop(e)})},update:function(t){this.startTimestamp||(this.startTimestamp=t),this.currentTimestamp=t,this.updateSetup(t),window.requestAnimationFrame(this.update.bind(this))},updateSetup:function(){this.currentSetupOffsets.forEach(function(e){var i;this.objs.forEach(function(t){!t.hasSetup(e)||t.isStatic()||t.isCompleted()||(i=!1,t.update(e))},this),void 0===i&&this.removeFromCurrentSetups(e)},this)},setTime:function(t){},setProgress:function(t){},appendObj:function(t){t.stage||t.stage===this||(this.objs.push(t),t.setStage(this))}},JStage.Obj=function(t,e,i,s,r){this.el,this.state={},this.intermediateState={},this.setups={},this.loops={},this.propDiff={},this.executingScripts={},this.currentSetup,this.width,this.height,this.left,this.top,this.duration=0,this.stage,this.status=JStage.Obj.IS_STATIC,this.setEl(t),this.setSize(e,i),this.setPosition(s,r)},JStage.Obj.PROP_DEFAULT={scale:1,scaleX:1,scaleY:1,translateX:0,translateY:0,rotate:0,skew:0,skewX:0,skewY:0},JStage.Obj.TRANSFORMS=["translateX","translateY","rotate","skew","skewX","skewY","scale","scaleX","scaleY"],JStage.Obj.INIT_SETUP="INIT_SETUP",JStage.Obj.OPEN_SETUP="OPEN_SETUP",JStage.Obj.IS_IDLE=0,JStage.Obj.IS_COMPLETED=2,JStage.Obj.IS_ANIMATING=3,JStage.Obj.IS_STATIC=4,JStage.Obj.addBatchSetups=function(t,i){t.forEach(function(t){for(var e in i)t.addSetup(e,i[e])})},JStage.Obj.prototype={setState:function(t,e){return this.state[t]=e,this},getPropDefaultValue:function(t){return void 0===JStage.Obj.PROP_DEFAULT[t]?0:JStage.Obj.PROP_DEFAULT[t]},createSetup:function(t){void 0===this.getSetup(t)&&(this.setups[t]={key:t,scripts:[],setups:[],index:0,startTimestamp:null})},addSetup:function(e,t){this.createSetup(e);var i=this.getSetup(e);return t instanceof Array&&0<t.length&&t.forEach(function(t){this.addScript(e,t)},this),i.duration=this.getDuration(i),this},addSetups:function(t){for(var e in t)this.addSetup(e,t[e])},addLoopSetup:function(i,t){this.createSetup(i),t.forEach(function(t){var e=this.getSetup(t);e&&this.getSetup(i).setups.push(e)},this)},addOpenSetup:function(t){return this.addSetup(JStage.Obj.OPEN_SETUP,t),this},addScript:function(t,e){return this.createSetup(t),this.status=JStage.Obj.IS_IDLE,this.setups[t].scripts.push(new JStage.Script(e.property,e.value,e.duration,e.delay,e.timingFunction)),this},getSetup:function(t){return this.setups[t]},getPropValue:function(t,e){return void 0===t[e]?this.getPropDefaultValue(e):t[e]},getPropDiffVal:function(t,e,i){if(-1<t.toLowerCase().indexOf("color"))throw"unsupported property "+t;return i-e},createPropDiff:function(t){var e,i=t.property;e="string"!=typeof t.value||0!==t.value.indexOf("+")&&0!==t.value.indexOf("-")?t.value:this.getPropValue(this.state,i)+parseInt(t.value),this.propDiff[t.property]={prop:i,diffVal:this.getPropDiffVal(t.property,this.getPropValue(this.state,i),e),fromVal:this.getPropValue(this.state,i)}},patchPropDiff:function(t,e){var i,s=e.property;i="string"!=typeof e.value||0!==e.value.indexOf("+")&&0!==e.value.indexOf("-")?e.value:this.getPropValue(this.intermediateState,s)+parseInt(e.value),t.diffVal=this.getPropDiffVal(e.property,this.getPropValue(this.intermediateState,s),i),t.fromVal=this.getPropValue(this.intermediateState,s)},getPropDiff:function(t){return this.propDiff[t]},updateIntermediateState:function(t,e){this.intermediateState[t.prop]=e*t.diffVal+t.fromVal},update:function(t){this.render(void 0===t?JStage.Obj.OPEN_SETUP:t)},stop:function(t){this.complete();var e=this.getSetup(t);0<e.setups.length&&(e.index=0)},render:function(){var i=this.currentSetup;if(i){if(0<i.setups.length){var s=i.setups[i.index];s.startTimestamp||(s.startTimestamp=performance?performance.now():Date.now());var r=this.getCurrentTimestamp();s.scripts.forEach(function(t){if(!(t.isComplete()||t.isSkip()||(n=s.startTimestamp,a=!1,0<t.delay&&(n+=t.delay),r<n))){var e=(r-n)/t.duration;1<e&&(e=1),t.executing(),void 0===this.executingScripts[t.property]&&(this.executingScripts[t.property]=t,this.createPropDiff(t)),this.executingScripts[t.property]===t||t.isSkip()||t.isComplete()||(this.executingScripts[t.property].isExecuting()&&this.executingScripts[t.property].skip(),this.executingScripts[t.property]=t,this.patchPropDiff(this.getPropDiff(t.property),t)),this.updateIntermediateState(this.getPropDiff(t.property),e),1===e&&t.complete()}},this),!1!==a&&(s.startTimestamp=null,i.index>=i.setups.length-1?i.index=0:i.index++,this.standbyLoop(i))}else{var n;i.startTimestamp||(i.startTimestamp=this.getStartTimestamp());var a;r=this.getCurrentTimestamp();i.scripts.forEach(function(t){if(!(t.isComplete()||t.isSkip()||(n=i.startTimestamp,a=!1,0<t.delay&&(n+=t.delay),r<n))){var e=(r-n)/t.duration;1<e&&(e=1),t.executing(),void 0===this.executingScripts[t.property]&&(this.executingScripts[t.property]=t,this.createPropDiff(t)),this.executingScripts[t.property]===t||t.isSkip()||t.isComplete()||(this.executingScripts[t.property].isExecuting()&&this.executingScripts[t.property].skip(),this.executingScripts[t.property]=t,this.patchPropDiff(this.getPropDiff(t.property),t)),this.updateIntermediateState(this.getPropDiff(t.property),e),1===e&&t.complete()}},this),!1===a?this.status=JStage.Obj.IS_ANIMATING:(this.status=JStage.Obj.IS_COMPLETED,i.startTimestamp=null)}this.renderState()}},renderState:function(){var t="";for(var e in this.intermediateState)if(-1<JStage.Obj.TRANSFORMS.indexOf(e))switch(e){case"translateX":case"translateY":t+=e+"("+this.intermediateState[e]+this.getScale()+"px) ";break;case"rotate":case"skew":case"skewX":case"skewY":t+=e+"("+this.intermediateState[e]+"deg) ";break;case"scale":case"scaleX":case"scaleY":t+=e+"("+this.intermediateState[e]+") "}else-1<["left","top","width","height"].indexOf(e)?this.el.style[e]=this.intermediateState[e]*this.getScale()+"px":this.el.style[e]=this.intermediateState[e];void 0!==t&&(this.el.style.transform=t)},setSize:function(t,e){return this.width=t,this.height=e,this.setState("width",t).setState("height",e),this},setPosition:function(t,e){return this.left=t,this.top=e,this.setState("left",t).setState("top",e),this},getScale:function(){return this.stage.scale},getStartTimestamp:function(){return this.stage.startTimestamp},getCurrentTimestamp:function(){return this.stage.currentTimestamp},getReady:function(){var t=this.getSetup(JStage.Obj.OPEN_SETUP);for(var e in void 0!==t&&(this.resetSetup(t),this.duration=this.getDuration(t)),this.intermediateState={},this.state)this.intermediateState[e]=this.state[e];this.renderState()},getSetupReady:function(t){this.intermediateState={};var e=this.getSetup(t),i=this.getFinState(e);for(var s in e.scripts)void 0===i[s]&&(i[s]=e.scripts[s]);for(var s in i)this.intermediateState[s]=i[s];this.duration=this.getDuration(e),this.renderState()},setEl:function(t){this.el=JStage.getEl(t)},isAnimating:function(){return this.status===JStage.Obj.IS_ANIMATING},isCompleted:function(){return this.status===JStage.Obj.IS_COMPLETED},complete:function(){this.status=JStage.Obj.IS_COMPLETED},isStatic:function(){return this.status===JStage.Obj.IS_STATIC},isIdle:function(){return this.status===JStage.Obj.IS_IDLE},recal:function(){this.isAnimating()||this.renderState()},appendToStage:function(t){t.appendObj(this)},setStage:function(t){this.stage=t},reset:function(){this.getReady()},setTime:function(t){},getDuration:function(t){var e=0,i=0;return t.scripts.forEach(function(t){i=t.duration+t.delay,e<i&&(e=i)}),e},getFinState:function(t){var e={},i={};return t.scripts.forEach(function(t){void 0===i[t.property]?(i[t.property]=t.delay,e[t.property]=t.property):t.delay>i[t.property]&&(i[t.property]=t.delay,e[t.property]=t.property)}),e},resetSetup:function(t){t.scripts.forEach(function(t){t.reset()})},standby:function(t){var e="object"==typeof t?t:this.getSetup(t);void 0!==e&&(0<e.setups.length&&e.setups.forEach(function(t){this.standby(t)},this),(this.currentSetup=e).startTimestamp=null,this.status=JStage.Obj.IS_IDLE,this.resetSetup(e))},standbyLoop:function(t){this.standby(t.setups[t.index]),this.currentSetup=t},hasSetup:function(t){return void 0!==this.setups[t]}},JStage.Script=function(t,e,i,s,r){this.transforms=["scaleX","scaleY","skewX","skewY","rotate","translateX","translateY"],this.id=JStage.Script.i++,this.property=t,this.value=e,this.duration=this.normalizeTime(i),this.timingFunction=r||"linear",this.delay=this.normalizeTime(s),this.status=JStage.Script.IDLE},JStage.Script.i=0,JStage.Script.IDLE=0,JStage.Script.EXECUTING=1,JStage.Script.SKIP=2,JStage.Script.COMPLETE=3,JStage.Script.prototype={reset:function(){this.status=JStage.Script.IDLE},executing:function(){this.status=JStage.Script.EXECUTING},skip:function(){this.status=JStage.Script.SKIP},complete:function(){this.status=JStage.Script.COMPLETE},isExecuting:function(){return this.status===JStage.Script.EXECUTING},isSkip:function(){return this.status===JStage.Script.SKIP},isComplete:function(){return this.status===JStage.Script.COMPLETE},normalizeTime:function(t){return t?"number"==typeof t?t:0<t.indexOf("ms")?t.slice(0,-2)-0:0<t.indexOf("s")?1e3*t.slice(0,-1):isNaN(t)?t:void 0:0},getProgressValue:function(t){return t*this.value}},function(t,e){"function"==typeof define&&define.amd?define(e):"object"==typeof module&&module.exports?module.exports=e():t.JStage=e()}(window,function(){return JStage});
//# sourceMappingURL=maps/JStage.min.js.map
