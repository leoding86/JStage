function JStage(t,e,s){this.el=JStage.getEl(t),this.width=e,this.height=s,this.scale,this.startTimestamp,this.currentTimestamp,this.duration=0,this.status=JStage.IS_IDLE,this.resources=[],this.objs=[]}JStage.getEl=function(t){if("string"==typeof t)return document.querySelector(t);if(t instanceof jQuery)return t[0];if("object"==typeof t&&t instanceof Node&&0<t.nodeType)return t;throw"Invalid el"},JStage.IS_IDLE=0,JStage.IS_FINISHED=1,JStage.prototype={addResource:function(t){return this.resources.indexOf(t)<0&&this.resources.push(t),this},loadResources:function(s){var i=this.resources.length,r=0;this.resources.forEach(function(t){var e=new Image;e.onload=function(){console.log("image load"),r++,s.onProgress&&"function"==typeof s.onProgress&&s.onProgress.call(this,i,r),r===i&&s.onComplete&&"function"==typeof s.onComplete&&s.onComplete.call(null)},e.src=t,e.complete&&e.load()})},createObj:function(t,e,s,i,r){var n=new JStage.Obj(t,e,s,i,r);return this.appendObj(n),n},init:function(){var e=this;this.setScale(this.el.offsetWidth,this.el.offsetHeight),this.el.style.width=this.width*this.scale+"px",this.el.style.height=this.height*this.scale+"px",this.objs.forEach(function(t){t.getReady(),t.duration>e.duration&&(e.duration=t.duration)})},resizeEl:function(t,e){this.setScale(t,e),this.el.style.width=this.width*this.scale+"px",this.el.style.height=this.height*this.scale+"px",this.objs.forEach(function(t){t.recal()})},setScale:function(t,e){var s=t/this.width,i=e/this.height;return this.scale=i<s?i:s,this},start:function(){window.requestAnimationFrame?window.requestAnimationFrame(this.update.bind(this)):this.objs.forEach(function(t){obj.isStatic()||obj.setProgress(1)})},update:function(t){var e;this.startTimestamp||(this.startTimestamp=t),this.currentTimestamp=t;for(var s=0,i=this.objs.length;s<i;s++){var r=this.objs[s];r.isStatic()||r.isCompleted()||(e=!1,r.render())}!1===e&&window.requestAnimationFrame(this.update.bind(this))},setTime:function(t){for(var e=0,s=this.objs.length;e<s;e++)this.objs[e].isStatic()||this.objs[e].setTime(t)},setProgress:function(t){var e=this.duration*t;this.setTime(e)},appendObj:function(t){t.stage||t.stage===this||(this.objs.push(t),t.setStage(this))}},JStage.Obj=function(t,e,s,i,r){this.el,this.width,this.height,this.left,this.top,this.duration=0,this.transform={scaleX:1,scaleY:1},this.transformState={},this.transformPrevState={},this.style={opacity:1},this.styleState={},this.stylePrevState={},this.stage,this.prevObj,this.status=JStage.Obj.IS_STATIC,this.scripts=[],this.setEl(t),this.setSize(e,s),this.setPosition(i,r)},JStage.Obj.IS_IDLE=0,JStage.Obj.IS_COMPLETED=2,JStage.Obj.IS_ANIMATING=3,JStage.Obj.IS_STATIC=4,JStage.Obj.prototype={setSize:function(t,e){return this.width=t,this.height=e,this.setStyle("width",t).setStyle("height",e),this},setPosition:function(t,e){return this.left=t,this.top=e,this.setStyle("left",t).setStyle("top",e),this},setTransform:function(t,e){return this.transform[t]=e,this},setStyle:function(t,e){return this.style[t]=e,this},setScripts:function(t){this.scripts=t},addScript:function(t,e,s,i,r){return this.isStatic()&&(this.status=JStage.Obj.IS_IDLE),this.scripts.push(new JStage.Script(t,e,s,i,r)),this},getScale:function(){return this.stage.scale},getStartTimestamp:function(){return this.stage.startTimestamp},getCurrentTimestamp:function(){return this.stage.currentTimestamp},getReady:function(){for(var t in this.style)this.stylePrevState[t]=this.style[t],this.styleState[t]=this.style[t];for(var e in this.transform)this.transformPrevState[e]=this.transform[e],this.transformState[e]=this.transform[e];this.duration=this.getDuration(),this.renderStyle(this.styleState),this.renderTransform(this.transformState)},setElSize:function(){return this.setElWidth(this.width).setElHeight(this.height),this},setElWidth:function(t){return this.el.style.width=t*this.getScale()+"px",this},setElHeight:function(t){return this.el.style.height=t*this.getScale()+"px",this},setElPosition:function(){return this.setElLeft(this.left).setElTop(this.top),this},setElLeft:function(t){return this.el.style.left=t*this.getScale()+"px",this},setElTop:function(t){return this.el.style.top=t*this.getScale()+"px",this},setElStyle:function(){return this.renderStyle(this.style),this},setElTransform:function(){return this.renderTransform(this.transform),this},setEl:function(t){this.el=JStage.getEl(t),["absolute"].indexOf(this.el.style.position)<0&&console.warn("Stage object position style should be 'absolute'")},isAnimating:function(){return this.status===JStage.Obj.IS_ANIMATING},isCompleted:function(){return this.status===JStage.Obj.IS_COMPLETED},isStatic:function(){return this.status===JStage.Obj.IS_STATIC},isIdle:function(){return this.status===JStage.Obj.IS_IDLE},recal:function(){this.isAnimating()||(this.renderStyle(this.styleState),this.renderTransform(this.transformState))},appendToStage:function(t){t.appendObj(this)},setStage:function(t){this.stage=t},render:function(){var i=this,r=!0;this.scripts.forEach(function(t){if(!t.isCompleted){r=!1;var e=i.getStartTimestamp();if(0<t.delay&&(e+=t.delay)>=i.getCurrentTimestamp())return;var s=(i.getCurrentTimestamp()-e)/t.duration;1<s&&(t.completed(),s=1),i.updateState(t,s)}}),this.renderStyle(this.styleState),this.renderTransform(this.transformState),this.status=r?JStage.Obj.IS_COMPLETED:JStage.Obj.IS_ANIMATING},reset:function(){this.getReady()},setTime:function(i){this.reset();var r=this;this.scripts.forEach(function(t){var e=0;if(!(0<t.delay&&(e=t.delay,i<=e))){var s=(i-e)/t.duration;1<s&&(s=1),r.updateState(t,s)}}),this.renderStyle(this.styleState),this.renderTransform(this.transformState)},getDuration:function(){var s=0;return this.scripts.forEach(function(t){var e=t.delay+t.duration;s<e&&(s=e)}),s},updateState:function(t,e){t.isTransform()?(this.transformState[t.property]=(this.transformPrevState[t.property]?this.transformPrevState[t.property]:0)-0+t.getProgressValue(e),1===e&&(this.transformPrevState[t.property]=this.transformState[t.property])):(this.styleState[t.property]=(this.stylePrevState[t.property]?this.stylePrevState[t.property]:0)-0+t.getProgressValue(e),1===e&&(this.stylePrevState[t.property]=this.styleState[t.property]))},renderStyle:function(t){for(var e in t)-1<["left","top","width","height"].indexOf(e)?this.el.style[e]=t[e]*this.getScale()+"px":this.el.style[e]=t[e]},renderTransform:function(t){var e="";for(var s in t)switch(s){case"translateX":case"translateY":e+=s+"("+t[s]+this.getScale()+"px) ";break;case"rotate":case"skewX":case"skewY":e+=s+"("+t[s]+"deg) ";break;case"scaleX":case"scaleY":e+=s+"("+t[s]+") "}e&&(this.el.style.transform=e)}},JStage.Script=function(t,e,s,i,r){this.transforms=["scaleX","scaleY","skewX","skewY","rotate","translateX","translateY"],this.property=t,this.value=e,this.duration=this.normalizeTime(s),this.timingFunction=i||"linear",this.delay=this.normalizeTime(r),this.isCompleted=!1},JStage.Script.prototype={completed:function(){this.isCompleted=!0},isTransform:function(){return-1<this.transforms.indexOf(this.property)},getTransitionStyle:function(){return this.property+" "+this.duration+"ms "+this.timingFunction+" "+this.delay+"ms"},normalizeTime:function(t){if(!t)return 0;if(0<t.indexOf("ms"))return t.slice(0,-2)-0;if(0<t.indexOf("s"))return 1e3*t.slice(0,-1);if(isNaN(t))throw"Invalid time"},getProgressValue:function(t){return t*this.value}},function(t,e){"function"==typeof define&&define.amd?define(e):"object"==typeof module&&module.exports?module.exports=e():t.JStage=e()}(window,function(){return JStage});
//# sourceMappingURL=maps/JStage.min.js.map
